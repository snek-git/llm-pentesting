import json
import logging
import requests

# Configuring basic logging
logging.basicConfig(
    filename='pentest_log.txt',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)


def load_payloads(file_path):
    """Load test payloads from a specified JSON file."""
    with open(file_path, 'r', encoding='utf-8') as file:
        return json.load(file)


def send_test_payload(target_url, payload):
    """Send a test payload to the target URL and return the response."""
    try:
        response = requests.post(target_url, json=payload)
        response.raise_for_status()
        return response.text
    except requests.RequestException as e:
        logging.error(f"Request failed: {e}")
        return None


def analyze_response(payload, response):
    """Log the payload and response for analysis."""
    logging.info(f"Payload: {json.dumps(payload)}")
    logging.info(f"Response: {response}")


def main():
    """Main function to execute the script."""
    target_url = 'http://example.com/api/v1/llm-endpoint'
    payloads = load_payloads('jailbreak_payloads.json')

    for payload in payloads:
        print(f"Testing payload: {json.dumps(payload)}")
        response = send_test_payload(target_url, payload)
        if response:
            analyze_response(payload, response)
        else:
            print("Failed to receive a response for the payload.")


if __name__ == "__main__":
    main()
